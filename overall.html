<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>NFL Picks â€“ Overall Standings</title>
  <style>
    body { background:#0b1220; color:#e6edf3; font-family: system-ui, sans-serif; }
    .wrap { max-width: 800px; margin: 2rem auto; }
    .card { background:#111a2f; border:1px solid #1f2937; border-radius:12px; padding:16px; }
    table { width:100%; border-collapse: collapse; margin-top:1rem; }
    th,td { padding:8px; border-bottom:1px solid #1f2937; }
    th { text-align:left; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Overall Standings</h1>
    <p>Totals across <b>all weeks</b>. Updates live as admins mark wins/losses.</p>
    <div class="card">
      <table id="standings">
        <thead>
          <tr><th>Rank</th><th>Player</th><th>Wins</th><th>Losses</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
  
  <script>
    window.FIREBASE_CONFIG = {
      apiKey: "AIzaSyCBgBR2n4e5ObgQOpRNRQQtZ7AhKLBr080",
      authDomain: "nfl-picks-b83c2.firebaseapp.com",
      projectId: "nfl-picks-b83c2",
      storageBucket: "nfl-picks-b83c2.firebasestorage.app",
      messagingSenderId: "802058909501",
      appId: "1:802058909501:web:bb935c188891934de07754",
      measurementId: "G-MSJHYZ4VG2"
    };
  </script>

  <script type="module">
    import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";
    
    const app = getApps().length ? getApps()[0] : initializeApp(window.FIREBASE_CONFIG);
    const auth = getAuth(app);
    const db = getFirestore(app);
    
    // Sign in anonymously so reads work
    await signInAnonymously(auth);

    const tbody = document.querySelector("#standings tbody");

    // Map uid -> { name, wins, losses }
    const stats = {};

    function render() {
      const rows = Object.values(stats)
        .sort((a,b)=> b.wins-a.wins || a.losses-b.losses || a.name.localeCompare(b.name))
        .map((r,i)=> `<tr><td>${i+1}</td><td>${r.name}</td><td>${r.wins}</td><td>${r.losses}</td></tr>`)
        .join("");
      tbody.innerHTML = rows || `<tr><td colspan=4>No data</td></tr>`;
    }

    // Watch all picks across all weeks
    onSnapshot(collectionGroup(db, "picks"), snap=>{
      snap.forEach(doc=>{
        const d = doc.data();
        const uid = d.userId || doc.ref.parent.parent.parent.id; // picks -> week -> uid
        if (!stats[uid]) stats[uid] = { name: d.userName || uid, wins:0, losses:0 };
        if (d.correct === true) stats[uid].wins++;
        else if (d.correct === false) stats[uid].losses++;
      });
      render();
    });
  </script>
</body>
</html>
